local MinimalGUI = {}
local TweenService = game:GetService('TweenService')
local UserInputService = game:GetService('UserInputService')
local CoreGui = game:GetService('CoreGui')

local Config = {
	Colors = {
		Background = Color3.fromRGB(25, 25, 25),
		Surface = Color3.fromRGB(35, 35, 35),
		Surface2 = Color3.fromRGB(45, 45, 45),
		Primary = Color3.fromRGB(70, 130, 255),
		PrimaryHover = Color3.fromRGB(90, 150, 255),
		Text = Color3.fromRGB(255, 255, 255),
		TextSecondary = Color3.fromRGB(180, 180, 180),
		TextMuted = Color3.fromRGB(120, 120, 120),
		Border = Color3.fromRGB(60, 60, 60),
	},
	Fonts = {
		Regular = Enum.Font.Gotham,
		Medium = Enum.Font.GothamMedium,
	},
	Animation = { Fast = 0.1, Medium = 0.2 },
	Layout = {
		RowHeight = 28,
		RowSpacing = 4,
		EdgePadding = 8,
		MaxWidth = 380
	}
}

local function Tween(object, properties, duration, style)
	return TweenService:Create(object, 
		TweenInfo.new(duration or Config.Animation.Medium, style or Enum.EasingStyle.Quart, Enum.EasingDirection.Out), 
		properties)
end

function MinimalGUI:CreateWindow(title, size)
	title = title or 'MinimalGUI'
	size = size or UDim2.new(0, Config.Layout.MaxWidth, 0, 320)

	local window = { Pages = {}, CurrentPage = nil, _connections = {} }

	local gui = Instance.new('ScreenGui')
	gui.Name = 'MinimalGUI'
	gui.Parent = CoreGui
	gui.ResetOnSpawn = false
	gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

	-- Main window frame (no backdrop)
	local main = Instance.new('Frame')
	main.Size = size
	main.Position = UDim2.new(0.5, 0, 0.5, 0)
	main.AnchorPoint = Vector2.new(0.5, 0.5)
	main.BackgroundColor3 = Config.Colors.Background
	main.BorderSizePixel = 1
	main.BorderColor3 = Config.Colors.Border
	main.Parent = gui

	-- Header
	local header = Instance.new('Frame')
	header.Size = UDim2.new(1, 0, 0, 30)
	header.BackgroundColor3 = Config.Colors.Surface
	header.BorderSizePixel = 0
	header.Parent = main

	local titleText = Instance.new('TextLabel')
	titleText.Size = UDim2.new(1, -60, 1, 0)
	titleText.Position = UDim2.new(0, Config.Layout.EdgePadding, 0, 0)
	titleText.BackgroundTransparency = 1
	titleText.Text = title
	titleText.TextColor3 = Config.Colors.Text
	titleText.TextSize = 14
	titleText.Font = Config.Fonts.Medium
	titleText.TextXAlignment = Enum.TextXAlignment.Left
	titleText.Parent = header

	local closeBtn = Instance.new('TextButton')
	closeBtn.Size = UDim2.new(0, 20, 0, 20)
	closeBtn.Position = UDim2.new(1, -25, 0.5, -10)
	closeBtn.BackgroundColor3 = Config.Colors.Surface2
	closeBtn.BorderSizePixel = 0
	closeBtn.Text = '×'
	closeBtn.TextColor3 = Config.Colors.TextMuted
	closeBtn.TextSize = 14
	closeBtn.Font = Config.Fonts.Regular
	closeBtn.Parent = header

	closeBtn.MouseEnter:Connect(function()
		Tween(closeBtn, { BackgroundColor3 = Color3.fromRGB(200, 60, 60) }, Config.Animation.Fast):Play()
	end)
	closeBtn.MouseLeave:Connect(function()
		Tween(closeBtn, { BackgroundColor3 = Config.Colors.Surface2 }, Config.Animation.Fast):Play()
	end)
	closeBtn.MouseButton1Click:Connect(function()
		gui:Destroy()
	end)

	-- Tab Container (compact, horizontal)
	local tabContainer = Instance.new('Frame')
	tabContainer.Size = UDim2.new(1, 0, 0, 24)
	tabContainer.Position = UDim2.new(0, 0, 0, 30)
	tabContainer.BackgroundColor3 = Config.Colors.Surface
	tabContainer.BorderSizePixel = 0
	tabContainer.Parent = main

	local tabLayout = Instance.new('UIListLayout')
	tabLayout.FillDirection = Enum.FillDirection.Horizontal
	tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
	tabLayout.Padding = UDim.new(0, 1)
	tabLayout.Parent = tabContainer

	-- Content area
	local content = Instance.new('Frame')
	content.Size = UDim2.new(1, -Config.Layout.EdgePadding * 2, 1, -62)
	content.Position = UDim2.new(0, Config.Layout.EdgePadding, 0, 54)
	content.BackgroundTransparency = 1
	content.Parent = main

	-- Drag functionality
	local dragData = {}
	header.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragData.dragging = true
			dragData.startPos = input.Position
			dragData.frameStart = main.Position
		end
	end)

	table.insert(window._connections, UserInputService.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement and dragData.dragging then
			local delta = input.Position - dragData.startPos
			main.Position = UDim2.new(
				dragData.frameStart.X.Scale, dragData.frameStart.X.Offset + delta.X,
				dragData.frameStart.Y.Scale, dragData.frameStart.Y.Offset + delta.Y
			)
		end
	end))

	table.insert(window._connections, UserInputService.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragData.dragging = false
		end
	end))

	function window:CreatePage(name)
		local page = { Name = name, Elements = {}, _frame = nil, _button = nil }

		-- Compact tab button
		local tabBtn = Instance.new('TextButton')
		tabBtn.Size = UDim2.new(0, 60, 1, 0)
		tabBtn.BackgroundColor3 = Config.Colors.Surface2
		tabBtn.BorderSizePixel = 0
		tabBtn.Text = name
		tabBtn.TextColor3 = Config.Colors.TextSecondary
		tabBtn.TextSize = 12
		tabBtn.Font = Config.Fonts.Regular
		tabBtn.LayoutOrder = #window.Pages + 1
		tabBtn.Parent = tabContainer

		-- Page frame with scrolling
		local pageFrame = Instance.new('ScrollingFrame')
		pageFrame.Size = UDim2.new(1, 0, 1, 0)
		pageFrame.BackgroundTransparency = 1
		pageFrame.BorderSizePixel = 0
		pageFrame.ScrollBarThickness = 2
		pageFrame.ScrollBarImageColor3 = Config.Colors.Primary
		pageFrame.ScrollBarImageTransparency = 0.5
		pageFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
		pageFrame.Visible = false
		pageFrame.Parent = content

		local pageLayout = Instance.new('UIListLayout')
		pageLayout.SortOrder = Enum.SortOrder.LayoutOrder
		pageLayout.Padding = UDim.new(0, Config.Layout.RowSpacing)
		pageLayout.Parent = pageFrame

		local pagePadding = Instance.new('UIPadding')
		pagePadding.PaddingTop = UDim.new(0, 4)
		pagePadding.PaddingBottom = UDim.new(0, 4)
		pagePadding.Parent = pageFrame

		pageLayout:GetPropertyChangedSignal('AbsoluteContentSize'):Connect(function()
			pageFrame.CanvasSize = UDim2.new(0, 0, 0, pageLayout.AbsoluteContentSize.Y + 8)
		end)

		-- Tab switching
		tabBtn.MouseButton1Click:Connect(function()
			for _, p in pairs(window.Pages) do
				p._frame.Visible = false
				Tween(p._button, { 
					BackgroundColor3 = Config.Colors.Surface2, 
					TextColor3 = Config.Colors.TextSecondary
				}, Config.Animation.Fast):Play()
			end
			pageFrame.Visible = true
			Tween(tabBtn, { 
				BackgroundColor3 = Config.Colors.Primary, 
				TextColor3 = Config.Colors.Text
			}, Config.Animation.Fast):Play()
			window.CurrentPage = page
		end)

		tabBtn.MouseEnter:Connect(function()
			if window.CurrentPage ~= page then
				Tween(tabBtn, { BackgroundColor3 = Config.Colors.Surface }, Config.Animation.Fast):Play()
			end
		end)
		tabBtn.MouseLeave:Connect(function()
			if window.CurrentPage ~= page then
				Tween(tabBtn, { BackgroundColor3 = Config.Colors.Surface2 }, Config.Animation.Fast):Play()
			end
		end)

		page._button = tabBtn
		page._frame = pageFrame

		function page:CreateButton(text, callback)
			local container = Instance.new('Frame')
			container.Size = UDim2.new(1, 0, 0, Config.Layout.RowHeight)
			container.BackgroundTransparency = 1
			container.Parent = pageFrame

			local btn = Instance.new('TextButton')
			btn.Size = UDim2.new(1, 0, 1, 0)
			btn.BackgroundColor3 = Config.Colors.Primary
			btn.BorderSizePixel = 0
			btn.Text = text
			btn.TextColor3 = Config.Colors.Text
			btn.TextSize = 12
			btn.Font = Config.Fonts.Regular
			btn.Parent = container

			btn.MouseEnter:Connect(function()
				Tween(btn, { BackgroundColor3 = Config.Colors.PrimaryHover }, Config.Animation.Fast):Play()
			end)
			btn.MouseLeave:Connect(function()
				Tween(btn, { BackgroundColor3 = Config.Colors.Primary }, Config.Animation.Fast):Play()
			end)
			btn.MouseButton1Click:Connect(function()
				if callback then callback() end
			end)

			table.insert(page.Elements, container)
			return container
		end

		-- Compact Toggle - label left, toggle right, single row
		function page:CreateToggle(text, defaultValue, callback)
			local value = defaultValue or false

			local container = Instance.new('Frame')
			container.Size = UDim2.new(1, 0, 0, Config.Layout.RowHeight)
			container.BackgroundTransparency = 1
			container.Parent = pageFrame

			local label = Instance.new('TextLabel')
			label.Size = UDim2.new(1, -45, 1, 0)
			label.BackgroundTransparency = 1
			label.Text = text
			label.TextColor3 = Config.Colors.Text
			label.TextSize = 12
			label.Font = Config.Fonts.Regular
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = container

			local toggle = Instance.new('TextButton')
			toggle.Size = UDim2.new(0, 36, 0, 16)
			toggle.Position = UDim2.new(1, -36, 0.5, -8)
			toggle.BackgroundColor3 = value and Config.Colors.Primary or Config.Colors.Surface2
			toggle.BorderSizePixel = 0
			toggle.Text = ''
			toggle.Parent = container

			local thumb = Instance.new('Frame')
			thumb.Size = UDim2.new(0, 14, 0, 14)
			thumb.Position = value and UDim2.new(1, -15, 0.5, -7) or UDim2.new(0, 1, 0.5, -7)
			thumb.BackgroundColor3 = Config.Colors.Text
			thumb.BorderSizePixel = 0
			thumb.Parent = toggle

			toggle.MouseButton1Click:Connect(function()
				value = not value
				Tween(toggle, { BackgroundColor3 = value and Config.Colors.Primary or Config.Colors.Surface2 }, Config.Animation.Fast):Play()
				Tween(thumb, { Position = value and UDim2.new(1, -15, 0.5, -7) or UDim2.new(0, 1, 0.5, -7) }, Config.Animation.Fast):Play()
				if callback then callback(value) end
			end)

			table.insert(page.Elements, container)
			return container, function() return value end
		end

		-- Compact Slider - label and value on left, slim slider on right
		function page:CreateSlider(text, min, max, defaultValue, callback)
			min, max = min or 0, max or 100
			local value = defaultValue or min

			local container = Instance.new('Frame')
			container.Size = UDim2.new(1, 0, 0, Config.Layout.RowHeight)
			container.BackgroundTransparency = 1
			container.Parent = pageFrame

			local label = Instance.new('TextLabel')
			label.Size = UDim2.new(0.5, -20, 1, 0)
			label.BackgroundTransparency = 1
			label.Text = text
			label.TextColor3 = Config.Colors.Text
			label.TextSize = 12
			label.Font = Config.Fonts.Regular
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = container

			local valueLabel = Instance.new('TextLabel')
			valueLabel.Size = UDim2.new(0, 30, 1, 0)
			valueLabel.Position = UDim2.new(0.5, -20, 0, 0)
			valueLabel.BackgroundTransparency = 1
			valueLabel.Text = tostring(value)
			valueLabel.TextColor3 = Config.Colors.TextSecondary
			valueLabel.TextSize = 12
			valueLabel.Font = Config.Fonts.Regular
			valueLabel.TextXAlignment = Enum.TextXAlignment.Center
			valueLabel.Parent = container

			local track = Instance.new('TextButton')
			track.Size = UDim2.new(0.5, -10, 0, 8)
			track.Position = UDim2.new(0.5, 10, 0.5, -4)
			track.BackgroundColor3 = Config.Colors.Surface2
			track.BorderSizePixel = 0
			track.Text = ''
			track.Parent = container

			local fill = Instance.new('Frame')
			fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
			fill.BackgroundColor3 = Config.Colors.Primary
			fill.BorderSizePixel = 0
			fill.Parent = track

			local dragging = false

			local function updateSlider(input)
				local percent = math.clamp((input.Position.X - track.AbsolutePosition.X) / track.AbsoluteSize.X, 0, 1)
				value = math.round(min + (max - min) * percent)
				valueLabel.Text = tostring(value)
				fill.Size = UDim2.new(percent, 0, 1, 0)
				if callback then callback(value) end
			end

			track.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 then
					dragging = true
					updateSlider(input)
				end
			end)

			UserInputService.InputChanged:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
					updateSlider(input)
				end
			end)

			UserInputService.InputEnded:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 then
					dragging = false
				end
			end)

			table.insert(page.Elements, container)
			return container, function() return value end
		end

		-- Compact Dropdown - label left, dropdown right
		function page:CreateDropdown(text, options, defaultValue, callback)
			options = options or {}
			local value = defaultValue or (options[1] or 'Select...')
			local isOpen = false

			local container = Instance.new('Frame')
			container.Size = UDim2.new(1, 0, 0, Config.Layout.RowHeight)
			container.BackgroundTransparency = 1
			container.Parent = pageFrame

			local label = Instance.new('TextLabel')
			label.Size = UDim2.new(0.4, 0, 1, 0)
			label.BackgroundTransparency = 1
			label.Text = text
			label.TextColor3 = Config.Colors.Text
			label.TextSize = 12
			label.Font = Config.Fonts.Regular
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = container

			local dropdown = Instance.new('TextButton')
			dropdown.Size = UDim2.new(0.6, -5, 0, 20)
			dropdown.Position = UDim2.new(0.4, 5, 0.5, -10)
			dropdown.BackgroundColor3 = Config.Colors.Surface2
			dropdown.BorderSizePixel = 1
			dropdown.BorderColor3 = Config.Colors.Border
			dropdown.Text = ' ' .. value
			dropdown.TextColor3 = Config.Colors.Text
			dropdown.TextSize = 11
			dropdown.Font = Config.Fonts.Regular
			dropdown.TextXAlignment = Enum.TextXAlignment.Left
			dropdown.ClipsDescendants = true
			dropdown.Parent = container

			local arrow = Instance.new('TextLabel')
			arrow.Size = UDim2.new(0, 15, 1, 0)
			arrow.Position = UDim2.new(1, -15, 0, 0)
			arrow.BackgroundTransparency = 1
			arrow.Text = '▼'
			arrow.TextColor3 = Config.Colors.TextMuted
			arrow.TextSize = 8
			arrow.Font = Config.Fonts.Regular
			arrow.Parent = dropdown

			local optionsList = Instance.new('Frame')
			optionsList.Size = UDim2.new(0.6, -5, 0, 0)
			optionsList.Position = UDim2.new(0.4, 5, 1, 2)
			optionsList.BackgroundColor3 = Config.Colors.Surface
			optionsList.BorderSizePixel = 1
			optionsList.BorderColor3 = Config.Colors.Border
			optionsList.Visible = false
			optionsList.ZIndex = 100
			optionsList.Parent = container

			local optionsLayout = Instance.new('UIListLayout')
			optionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
			optionsLayout.Parent = optionsList

			local function toggleDropdown()
				isOpen = not isOpen
				local targetHeight = isOpen and (#options * 20) or 0

				optionsList.Visible = true
				Tween(optionsList, { Size = UDim2.new(0.6, -5, 0, targetHeight) }, Config.Animation.Fast):Play()

				if not isOpen then
					task.wait(Config.Animation.Fast)
					optionsList.Visible = false
				end
			end

			dropdown.MouseButton1Click:Connect(toggleDropdown)

			for i, option in ipairs(options) do
				local optionBtn = Instance.new('TextButton')
				optionBtn.Size = UDim2.new(1, 0, 0, 20)
				optionBtn.BackgroundColor3 = Config.Colors.Surface
				optionBtn.BackgroundTransparency = 1
				optionBtn.BorderSizePixel = 0
				optionBtn.Text = ' ' .. option
				optionBtn.TextColor3 = Config.Colors.Text
				optionBtn.TextSize = 11
				optionBtn.Font = Config.Fonts.Regular
				optionBtn.TextXAlignment = Enum.TextXAlignment.Left
				optionBtn.LayoutOrder = i
				optionBtn.Parent = optionsList

				optionBtn.MouseEnter:Connect(function()
					Tween(optionBtn, { BackgroundTransparency = 0, BackgroundColor3 = Config.Colors.Surface2 }, Config.Animation.Fast):Play()
				end)
				optionBtn.MouseLeave:Connect(function()
					Tween(optionBtn, { BackgroundTransparency = 1 }, Config.Animation.Fast):Play()
				end)
				optionBtn.MouseButton1Click:Connect(function()
					value = option
					dropdown.Text = ' ' .. option
					toggleDropdown()
					if callback then callback(option) end
				end)
			end

			table.insert(page.Elements, container)
			return container, function() return value end
		end

		window.Pages[name] = page

		if not window.CurrentPage then
			pageFrame.Visible = true
			Tween(tabBtn, { 
				BackgroundColor3 = Config.Colors.Primary, 
				TextColor3 = Config.Colors.Text
			}, Config.Animation.Fast):Play()
			window.CurrentPage = page
		end

		return page
	end

	function window:Destroy()
		for _, connection in pairs(window._connections) do
			connection:Disconnect()
		end
		gui:Destroy()
	end

	return window
end

return MinimalGUI
