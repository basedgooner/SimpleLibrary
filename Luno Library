local MinimalGUI = {}
print("loaded")
local TweenService = game:GetService('TweenService')
local UserInputService = game:GetService('UserInputService')
local CoreGui = game:GetService('CoreGui')

-- Check for existing GUI instance and destroy it to prevent duplicates
if getgenv then
    local existingGUI = getgenv().MinimalGUI_Instance
    if existingGUI and typeof(existingGUI.DestroyAll) == "function" then
        pcall(function() existingGUI:DestroyAll() end)
    end
end

-- Configuration for GUI appearance and animations
local Config = {
    Colors = {
        Light = {
            Background = Color3.fromRGB(240, 243, 247), -- Softer background
            Surface = Color3.fromRGB(255, 255, 255),    -- Pure white for card surfaces
            Surface2 = Color3.fromRGB(235, 240, 245),   -- Light gray for subtle elements
            Surface3 = Color3.fromRGB(215, 225, 235),   -- Medium gray for active states/track
            Primary = Color3.fromRGB(80, 75, 220),      -- Deep, rich indigo
            PrimaryHover = Color3.fromRGB(100, 95, 240),-- Brighter indigo for hover
            PrimaryDim = Color3.fromRGB(60, 55, 200),   -- Darker indigo for active/pressed
            Text = Color3.fromRGB(30, 40, 50),          -- Dark text
            TextSecondary = Color3.fromRGB(80, 90, 100),-- Muted text for descriptions
            TextMuted = Color3.fromRGB(160, 170, 180),  -- Even lighter text for icons/hints
            Success = Color3.fromRGB(30, 180, 90),      -- Verdant green
            Danger = Color3.fromRGB(220, 50, 50),       -- Vibrant red
            Warning = Color3.fromRGB(250, 150, 50),     -- Warm orange
            Border = Color3.fromRGB(200, 210, 220),     -- Soft border (Note: actual UIStroke color is forced white below)
            BorderLight = Color3.fromRGB(220, 230, 240),-- Very light border (Note: actual UIStroke color is forced white below)
            Accent = Color3.fromRGB(150, 70, 240),      -- Purple accent (not widely used)
            Shadow = Color3.fromRGB(0, 0, 0),           -- For subtle Frame outlines that act as shadows
        },
        Dark = {
            Background = Color3.fromRGB(20, 25, 35),    -- Deep dark blue-gray background
            Surface = Color3.fromRGB(35, 45, 60),       -- Darker surface for cards
            Surface2 = Color3.fromRGB(55, 65, 80),      -- Medium dark gray for subtle elements
            Surface3 = Color3.fromRGB(80, 90, 105),     -- Lighter dark gray for active states/track
            Primary = Color3.fromRGB(110, 105, 245),    -- Lighter indigo
            PrimaryHover = Color3.fromRGB(130, 125, 255),-- Even lighter indigo for hover
            PrimaryDim = Color3.fromRGB(90, 85, 225),   -- Original indigo for active/pressed
            Text = Color3.fromRGB(235, 240, 245),       -- Light text
            TextSecondary = Color3.fromRGB(150, 160, 175),-- Muted light text
            TextMuted = Color3.fromRGB(100, 110, 125),  -- Even darker light text for icons/hints
            Success = Color3.fromRGB(30, 180, 90),
            Danger = Color3.fromRGB(220, 50, 50),
            Warning = Color3.fromRGB(250, 150, 50),
            Border = Color3.fromRGB(60, 70, 85),        -- Dark border
            BorderLight = Color3.fromRGB(45, 55, 70),   -- Very dark border
            Accent = Color3.fromRGB(150, 70, 240),
            Shadow = Color3.fromRGB(0, 0, 0),
        },
    },
    Fonts = {
        Regular = Enum.Font.Gotham,
        Medium = Enum.Font.GothamMedium,
        Bold = Enum.Font.GothamBold,
    },
    Spacing = { xs = 4, sm = 8, md = 12, lg = 16, xl = 24 },
    Radius = { sm = 6, md = 10, lg = 16, xl = 20 }, -- Finer radii for a sleek look
    Animation = { Fast = 0.08, Medium = 0.15, Slow = 0.25 }, -- Faster, snappier animations
    Easing = {
        Main = Enum.EasingStyle.Quart,    -- For main window entrance/exit
        Interaction = Enum.EasingStyle.Cubic, -- For button/hover interactions (snappier)
        Slide = Enum.EasingStyle.Quint,   -- For slider/toggle movement
        Bounce = Enum.EasingStyle.Back,   -- For subtle "pop" effects
    },
    Layout = {
        RowHeight = 44,       -- Slightly more compact row height
        RowSpacing = 10,      -- Reduced spacing between rows
        EdgePadding = 20,     -- Consistent padding inside sections
        MaxWidth = 520,       -- Slightly narrower window
        MaxHeight = 380,      -- Slightly shorter window
    },
}

-- Helper function for creating tweens with defined defaults
local function Tween(object, properties, duration, style, direction)
    return TweenService:Create(
        object,
        TweenInfo.new(
            duration or Config.Animation.Medium,
            style or Config.Easing.Interaction,
            direction or Enum.EasingDirection.Out
        ),
        properties
    )
end

-- Helper function for adding UICorner
local function Corner(parent, radius)
    local corner = Instance.new('UICorner')
    corner.CornerRadius = UDim.new(0, radius or Config.Radius.md)
    corner.Parent = parent
    return corner
end

-- Helper function for adding UIStroke (border effect)
-- As per instruction, this function now forces the stroke color to white.
local function Stroke(parent, _, thickness, transparency, applyMode)
    local stroke = Instance.new('UIStroke')
    stroke.Color = Color3.new(1, 1, 1) -- force white outline
    stroke.Thickness = thickness or 1
    stroke.Transparency = transparency or 0
    stroke.ApplyStrokeMode = applyMode or Enum.ApplyStrokeMode.Border
    stroke.Parent = parent
    return stroke
end

-- Helper for an outline/highlight effect using UIStroke.
-- This is useful for secondary strokes or effects that need to be distinctly added,
-- and its color is also hardcoded white due to the overall theme requirement.
local function FrameOutline(parent, thickness, transparency, applyMode, offset)
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.new(1, 1, 1) -- Keep this white as per general instruction for outlines.
    stroke.Thickness = thickness or 1
    stroke.Transparency = transparency or 0
    stroke.ApplyStrokeMode = applyMode or Enum.ApplyStrokeMode.Border
    stroke.LineJoinMode = Enum.LineJoinMode.Round
    if offset then
        stroke.Offset = offset
    end
    stroke.Parent = parent
    return stroke
end


-- Helper function for adding a subtle UIListLayout
local function ListLayout(parent, padding, fillDirection, alignment)
    local layout = Instance.new('UIListLayout')
    layout.Padding = UDim.new(0, padding or Config.Spacing.md)
    layout.FillDirection = fillDirection or Enum.FillDirection.Vertical
    layout.HorizontalAlignment = alignment and alignment.H or Enum.HorizontalAlignment.Left
    layout.VerticalAlignment = alignment and alignment.V or Enum.VerticalAlignment.Top
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = parent
    return layout
end

-- --- NOTIFICATION SYSTEM ---
local NotificationsScreenGui = nil
local NotificationsFrame = nil
local notificationQueue = {}

-- Sets up the single ScreenGui and Frame to hold all notifications
local function setupNotificationContainer()
    if NotificationsScreenGui and NotificationsScreenGui.Parent then return end

    NotificationsScreenGui = Instance.new('ScreenGui')
    NotificationsScreenGui.Name = 'MinimalGUI_Notifications_Container'
    NotificationsScreenGui.Parent = CoreGui
    NotificationsScreenGui.ResetOnSpawn = false
    NotificationsScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    NotificationsScreenGui.DisplayOrder = 100 -- Ensure notifications are always on top

    NotificationsFrame = Instance.new('Frame')
    NotificationsFrame.Name = 'NotificationsFrame'
    NotificationsFrame.Size = UDim2.new(0, 360, 1, -Config.Spacing.xl * 2) -- Fixed width, dynamic height based on padding
    NotificationsFrame.Position = UDim2.new(1, -Config.Spacing.xl - NotificationsFrame.Size.X.Offset, 0, Config.Spacing.xl)
    NotificationsFrame.BackgroundTransparency = 1
    NotificationsFrame.BorderSizePixel = 0
    NotificationsFrame.ClipsDescendants = true
    NotificationsFrame.Parent = NotificationsScreenGui

    ListLayout(NotificationsFrame, Config.Spacing.md, Enum.FillDirection.Vertical, { H = Enum.HorizontalAlignment.Right, V = Enum.VerticalAlignment.Top })
end

-- Creates and manages a single notification pop-up
local function createNotification(message, notificationType)
    setupNotificationContainer()

    local colors = Config.Colors.Light -- Notifications always use Light theme for visual consistency

    local accentColor = colors.Primary
    local iconText = "â„¹"

    if notificationType == 'success' then
        accentColor = colors.Success
        iconText = "âœ“"
    elseif notificationType == 'danger' then
        accentColor = colors.Danger
        iconText = "âœ•"
    elseif notificationType == 'warning' then
        accentColor = colors.Warning
        iconText = "âš "
    end

    local notification = Instance.new('Frame')
    notification.Name = 'Notification_' .. os.time()
    notification.Size = UDim2.new(1, 0, 0, 68) -- Slightly shorter height
    notification.BackgroundTransparency = 1
    notification.BorderSizePixel = 0
    notification.Parent = NotificationsFrame
    notification.ClipsDescendants = true
    notification.LayoutOrder = #notificationQueue + 1

    local bgFrame = Instance.new('Frame')
    bgFrame.Size = UDim2.new(1, 0, 1, 0)
    bgFrame.BackgroundColor3 = colors.Surface
    bgFrame.BorderSizePixel = 0
    bgFrame.Parent = notification
    Corner(bgFrame, Config.Radius.lg)
    Stroke(bgFrame, nil, 1) -- White stroke for notification background

    local accentBar = Instance.new('Frame')
    accentBar.Size = UDim2.new(0, 4, 1, -Config.Spacing.sm * 2)
    accentBar.Position = UDim2.new(0, Config.Spacing.sm, 0, Config.Spacing.sm)
    accentBar.BackgroundColor3 = accentColor
    accentBar.BorderSizePixel = 0
    accentBar.Parent = bgFrame
    Corner(accentBar, 2)

    local iconContainer = Instance.new('Frame')
    iconContainer.Size = UDim2.new(0, 36, 0, 36)
    iconContainer.Position = UDim2.new(0, Config.Spacing.md + Config.Spacing.sm, 0.5, -18)
    iconContainer.BackgroundColor3 = accentColor
    iconContainer.BackgroundTransparency = 0.85
    iconContainer.BorderSizePixel = 0
    iconContainer.Parent = bgFrame
    Corner(iconContainer, 18)

    local icon = Instance.new('TextLabel')
    icon.Size = UDim2.new(1, 0, 1, 0)
    icon.BackgroundTransparency = 1
    icon.Text = iconText
    icon.TextColor3 = accentColor
    icon.TextSize = 15
    icon.Font = Config.Fonts.Bold
    icon.TextXAlignment = Enum.TextXAlignment.Center
    icon.TextYAlignment = Enum.TextYAlignment.Center
    icon.Parent = iconContainer

    local text = Instance.new('TextLabel')
    text.Size = UDim2.new(1, -(Config.Spacing.lg * 2 + 36 + Config.Spacing.sm + 28), 1, -Config.Spacing.sm * 2)
    text.Position = UDim2.new(0, Config.Spacing.lg * 2 + 36 + Config.Spacing.sm, 0, Config.Spacing.sm)
    text.BackgroundTransparency = 1
    text.Text = message
    text.TextColor3 = colors.Text
    text.TextSize = 13
    text.Font = Config.Fonts.Medium
    text.TextXAlignment = Enum.TextXAlignment.Left
    text.TextYAlignment = Enum.TextYAlignment.Center
    text.TextWrapped = true
    text.RichText = false
    text.Parent = bgFrame

    local closeBtn = Instance.new('TextButton')
    closeBtn.Size = UDim2.new(0, 20, 0, 20)
    closeBtn.Position = UDim2.new(1, -Config.Spacing.lg, 0, Config.Spacing.sm)
    closeBtn.BackgroundColor3 = colors.Surface2
    closeBtn.BackgroundTransparency = 1
    closeBtn.BorderSizePixel = 0
    closeBtn.Text = "Ã—"
    closeBtn.TextColor3 = colors.TextMuted
    closeBtn.TextSize = 15
    closeBtn.Font = Config.Fonts.Medium
    closeBtn.AutoButtonColor = false
    closeBtn.Parent = bgFrame
    Corner(closeBtn, 10)

    closeBtn.MouseEnter:Connect(function()
        Tween(closeBtn, { BackgroundTransparency = 0, BackgroundColor3 = colors.Danger, TextColor3 = Color3.fromRGB(255, 255, 255),
                         Size = UDim2.new(0, 22, 0, 22), Position = UDim2.new(1, -Config.Spacing.lg - 1, 0, Config.Spacing.sm - 1) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
    end)
    closeBtn.MouseLeave:Connect(function()
        Tween(closeBtn, { BackgroundTransparency = 1, TextColor3 = colors.TextMuted,
                         Size = UDim2.new(0, 20, 0, 20), Position = UDim2.new(1, -Config.Spacing.lg, 0, Config.Spacing.sm) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
    end)

    local progressBar = Instance.new('Frame')
    progressBar.Size = UDim2.new(1, -Config.Spacing.md, 0, 2)
    progressBar.Position = UDim2.new(0, Config.Spacing.sm, 1, -Config.Spacing.sm)
    progressBar.BackgroundColor3 = colors.Surface3
    progressBar.BackgroundTransparency = 0.7
    progressBar.BorderSizePixel = 0
    progressBar.Parent = bgFrame
    Corner(progressBar, 1)

    local progressFill = Instance.new('Frame')
    progressFill.Size = UDim2.new(1, 0, 1, 0)
    progressFill.BackgroundColor3 = accentColor
    progressFill.BackgroundTransparency = 0.2
    progressFill.BorderSizePixel = 0
    progressFill.Parent = progressBar
    Corner(progressFill, 1)

    -- Entrance animation
    notification.Position = UDim2.new(1.1, 0, 0, 0)
    Tween(notification, { Position = UDim2.new(0, 0, 0, 0) }, Config.Animation.Slow, Config.Easing.Bounce, Enum.EasingDirection.Out):Play()
    Tween(bgFrame, { Transparency = 0 }, Config.Animation.Slow, Config.Easing.Interaction):Play()

    table.insert(notificationQueue, notification)

    local dismissTween
    local progressTween = Tween(progressFill, { Size = UDim2.new(0, 0, 1, 0) }, 3.5, Enum.EasingStyle.Linear)
    progressTween:Play()

    local function dismissNotification()
        if dismissTween then return end
        dismissTween = true

        Tween(notification, { Position = UDim2.new(1.1, 0, 0, 0), Transparency = 1 }, Config.Animation.Medium, Config.Easing.Quart, Enum.EasingDirection.In):Play()

        local indexToRemove = nil
        for i, item in ipairs(notificationQueue) do
            if item == notification then
                indexToRemove = i
                break
            end
        end
        if indexToRemove then
            table.remove(notificationQueue, indexToRemove)
        end

        task.wait(Config.Animation.Medium + 0.05)
        if notification and notification.Parent then
            notification:Destroy()
        end
    end

    closeBtn.MouseButton1Click:Connect(dismissNotification)
    progressTween.Completed:Connect(dismissNotification)
end

-- --- MAIN WINDOW CREATION ---
function MinimalGUI:CreateWindow(title, size)
    title = title or 'MinimalGUI'
    size = size or UDim2.new(0, Config.Layout.MaxWidth, 0, Config.Layout.MaxHeight)

    local window = {
        Pages = {},
        CurrentPage = nil,
        _connections = {},
        _isDarkTheme = false,
    }

    self.CurrentWindow = window

    function window:getColors()
        return self._isDarkTheme and Config.Colors.Dark or Config.Colors.Light
    end

    function window:Notify(message, notificationType)
        task.spawn(createNotification, message, notificationType or 'info')
    end

    local function updateTheme()
        local colors = window:getColors()
        main.BackgroundColor3 = colors.Background
        header.BackgroundColor3 = colors.Surface
        headerSeparator.BackgroundColor3 = colors.BorderLight
        titleText.TextColor3 = colors.Text
        themeBtn.BackgroundColor3 = colors.Surface2
        themeBtn.TextColor3 = colors.TextMuted
        closeBtn.BackgroundColor3 = colors.Surface2
        closeBtn.TextColor3 = colors.TextMuted

        -- UIStrokes colors are hardcoded white by the Stroke function, so no need to update their Color3 property here.
        -- We only update elements that use background/text colors based on theme.

        for _, page in pairs(window.Pages) do
            if page._button and page._button.Parent then
                local currentTabStroke = page._button:FindFirstChild("TabButtonStroke")
                if window.CurrentPage == page then
                    page._button.BackgroundColor3 = colors.Primary
                    page._button.TextColor3 = Color3.fromRGB(255, 255, 255)
                    if currentTabStroke then Tween(currentTabStroke, { Transparency = 0 }, Config.Animation.Fast):Play() end
                else
                    page._button.BackgroundColor3 = colors.Surface2
                    page._button.TextColor3 = colors.TextSecondary
                    if currentTabStroke then Tween(currentTabStroke, { Transparency = 1 }, Config.Animation.Fast):Play() end
                end
            end
            -- For other elements, a full theme switch might require re-creation or complex binding
            -- but the core elements (like main window, header, tabs) are handled here.
        end
    end

    local gui = Instance.new('ScreenGui')
    gui.Name = 'MinimalGUI_MainWindow'
    gui.Parent = CoreGui
    gui.ResetOnSpawn = false
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    gui.DisplayOrder = 1 -- Lower than notifications

    local main = Instance.new('Frame')
    main.Size = size
    main.Position = UDim2.new(0.5, 0, 0.5, 0)
    main.AnchorPoint = Vector2.new(0.5, 0.5)
    main.BackgroundColor3 = window:getColors().Background
    main.BorderSizePixel = 0
    main.Parent = gui
    Corner(main, Config.Radius.xl)
    Stroke(main, nil, 1) -- Main window's primary white border
    local mainGlossEffect = FrameOutline(main, 5, 0.9, Enum.ApplyStrokeMode.Border) -- Subtle inner white glow for gloss
    mainGlossEffect.Name = "MainGlossEffect"
    main.Transparency = 1 -- Start transparent for fade-in

    local header = Instance.new('Frame')
    header.Size = UDim2.new(1, 0, 0, 52)
    header.BackgroundColor3 = window:getColors().Surface
    header.BorderSizePixel = 0
    header.Parent = main
    Corner(header, Config.Radius.xl) -- Apply radius matching window on top

    local headerSeparator = Instance.new('Frame')
    headerSeparator.Size = UDim2.new(1, -Config.Spacing.xl, 0, 1)
    headerSeparator.Position = UDim2.new(0, Config.Spacing.lg, 1, 0)
    headerSeparator.BackgroundColor3 = window:getColors().BorderLight
    headerSeparator.BackgroundTransparency = 0.8
    headerSeparator.BorderSizePixel = 0
    headerSeparator.Parent = header

    local titleText = Instance.new('TextLabel')
    titleText.Size = UDim2.new(0, 200, 0, 20)
    titleText.Position = UDim2.new(0, Config.Layout.EdgePadding, 0, 16)
    titleText.BackgroundTransparency = 1
    titleText.Text = title
    titleText.TextColor3 = window:getColors().Text
    titleText.TextSize = 15
    titleText.Font = Config.Fonts.Bold
    titleText.TextXAlignment = Enum.TextXAlignment.Left
    titleText.Parent = header

    local themeBtn = Instance.new('TextButton')
    themeBtn.Size = UDim2.new(0, 28, 0, 28)
    themeBtn.Position = UDim2.new(1, -Config.Layout.EdgePadding - 60, 0, 12)
    themeBtn.BackgroundColor3 = window:getColors().Surface2
    themeBtn.BorderSizePixel = 0
    themeBtn.Text = 'â˜€'
    themeBtn.TextColor3 = window:getColors().TextMuted
    themeBtn.TextSize = 14
    themeBtn.Font = Config.Fonts.Medium
    themeBtn.AutoButtonColor = false
    themeBtn.Parent = header
    Corner(themeBtn, 14)

    local themeBtnStroke = Stroke(themeBtn, nil, 1, 1)

    themeBtn.MouseEnter:Connect(function()
        Tween(themeBtn, { BackgroundColor3 = window:getColors().Surface3, TextColor3 = window:getColors().Text,
                         Size = UDim2.new(0, 30, 0, 30), Position = UDim2.new(1, -Config.Layout.EdgePadding - 61, 0, 11) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
        Tween(themeBtnStroke, { Transparency = 0 }, Config.Animation.Fast):Play()
    end)
    themeBtn.MouseLeave:Connect(function()
        Tween(themeBtn, { BackgroundColor3 = window:getColors().Surface2, TextColor3 = window:getColors().TextMuted,
                         Size = UDim2.new(0, 28, 0, 28), Position = UDim2.new(1, -Config.Layout.EdgePadding - 60, 0, 12) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
        Tween(themeBtnStroke, { Transparency = 1 }, Config.Animation.Fast):Play()
    end)
    themeBtn.MouseButton1Click:Connect(function()
        Tween(themeBtn, { Size = UDim2.new(0, 26, 0, 26), Position = UDim2.new(1, -Config.Layout.EdgePadding - 59, 0, 13) }, Config.Animation.Fast, Config.Easing.Interaction, Enum.EasingDirection.In):Play()
        task.wait(0.05)
        Tween(themeBtn, { Size = UDim2.new(0, 28, 0, 28), Position = UDim2.new(1, -Config.Layout.EdgePadding - 60, 0, 12) }, Config.Animation.Fast, Config.Easing.Interaction, Enum.EasingDirection.Out):Play()
        window._isDarkTheme = not window._isDarkTheme
        themeBtn.Text = window._isDarkTheme and 'ðŸŒ™' or 'â˜€'
        updateTheme()
    end)

    local closeBtn = Instance.new('TextButton')
    closeBtn.Size = UDim2.new(0, 28, 0, 28)
    closeBtn.Position = UDim2.new(1, -Config.Layout.EdgePadding - 28, 0, 12)
    closeBtn.BackgroundColor3 = window:getColors().Surface2
    closeBtn.BorderSizePixel = 0
    closeBtn.Text = 'Ã—'
    closeBtn.TextColor3 = window:getColors().TextMuted
    closeBtn.TextSize = 16
    closeBtn.Font = Config.Fonts.Medium
    closeBtn.AutoButtonColor = false
    closeBtn.Parent = header
    Corner(closeBtn, 14)

    local closeBtnStroke = Stroke(closeBtn, nil, 1, 1)

    closeBtn.MouseEnter:Connect(function()
        Tween(closeBtn, { BackgroundColor3 = window:getColors().Danger, TextColor3 = window:getColors().Surface,
                         Size = UDim2.new(0, 30, 0, 30), Position = UDim2.new(1, -Config.Layout.EdgePadding - 29, 0, 11) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
        Tween(closeBtnStroke, { Transparency = 0 }, Config.Animation.Fast):Play()
    end)
    closeBtn.MouseLeave:Connect(function()
        Tween(closeBtn, { BackgroundColor3 = window:getColors().Surface2, TextColor3 = window:getColors().TextMuted,
                         Size = UDim2.new(0, 28, 0, 28), Position = UDim2.new(1, -Config.Layout.EdgePadding - 28, 0, 12) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
        Tween(closeBtnStroke, { Transparency = 1 }, Config.Animation.Fast):Play()
    end)
    closeBtn.MouseButton1Click:Connect(function()
        Tween(closeBtn, { Size = UDim2.new(0, 26, 0, 26), Position = UDim2.new(1, -Config.Layout.EdgePadding - 27, 0, 13) }, Config.Animation.Fast, Config.Easing.Interaction, Enum.EasingDirection.In):Play()
        task.wait(0.05)
        Tween(closeBtn, { Size = UDim2.new(0, 28, 0, 28), Position = UDim2.new(1, -Config.Layout.EdgePadding - 28, 0, 12) }, Config.Animation.Fast, Config.Easing.Interaction, Enum.EasingDirection.Out):Play()

        Tween(main, {
            Size = UDim2.new(size.X.Scale * 0.8, size.X.Offset * 0.8, size.Y.Scale * 0.8, size.Y.Offset * 0.8),
            Transparency = 1,
            Position = UDim2.new(0.5, 0, 0.5, 0)
        }, Config.Animation.Slow, Config.Easing.Quart, Enum.EasingDirection.In):Play()
        if mainGlossEffect then Tween(mainGlossEffect, { Transparency = 1 }, Config.Animation.Slow):Play() end

        task.wait(Config.Animation.Slow + 0.05)
        if gui and gui.Parent then
            gui:Destroy()
        end
    end)

    local tabContainer = Instance.new('Frame')
    tabContainer.Size = UDim2.new(1, -Config.Layout.EdgePadding * 2, 0, 32)
    tabContainer.Position = UDim2.new(0, Config.Layout.EdgePadding, 0, 60) -- Header Height (52) + some spacing (8)
    tabContainer.BackgroundTransparency = 1
    tabContainer.BorderSizePixel = 0
    tabContainer.Parent = main

    ListLayout(tabContainer, Config.Spacing.sm, Enum.FillDirection.Horizontal)

    local content = Instance.new('Frame')
    -- Calculate content position based on tab container's height and spacing
    content.Position = UDim2.new(0, Config.Layout.EdgePadding, 0, tabContainer.Position.Y.Offset + tabContainer.Size.Y.Offset + Config.Spacing.md)
    -- Calculate content height based on remaining space from window bottom
    content.Size = UDim2.new(1, -Config.Layout.EdgePadding * 2, 0, Config.Layout.MaxHeight - content.Position.Y.Offset - Config.Spacing.xl)
    content.BackgroundTransparency = 1
    content.Parent = main

    local dragData = {}
    header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragData.dragging = true
            dragData.startPos = input.Position
            dragData.frameStart = main.Position
            main.ZIndex = 2 -- Bring to front when dragging
            -- Subtly adjust glossy effect for visual feedback when dragging
            if mainGlossEffect then Tween(mainGlossEffect, {Transparency = 0.5, Thickness = 8}, Config.Animation.Fast):Play() end
        end
    end)

    table.insert(
        window._connections,
        UserInputService.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement and dragData.dragging then
                local delta = input.Position - dragData.startPos
                main.Position = UDim2.new(
                    dragData.frameStart.X.Scale,
                    dragData.frameStart.X.Offset + delta.X,
                    dragData.frameStart.Y.Scale,
                    dragData.frameStart.Y.Offset + delta.Y
                )
            end
        end)
    )

    table.insert(
        window._connections,
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragData.dragging = false
                main.ZIndex = 1 -- Reset ZIndex
                if mainGlossEffect then Tween(mainGlossEffect, {Transparency = 0.9, Thickness = 5}, Config.Animation.Fast):Play() end
            end
        end)
    )

    function window:CreatePage(name)
        local page = { Name = name, Elements = {}, _frame = nil, _button = nil }

        local tabBtn = Instance.new('TextButton')
        tabBtn.Size = UDim2.new(0, 0, 0, 30) -- Fixed height, width will be AutomaticSize.X
        tabBtn.AutomaticSize = Enum.AutomaticSize.X
        tabBtn.BackgroundColor3 = window:getColors().Surface2
        tabBtn.BorderSizePixel = 0
        tabBtn.Text = name
        tabBtn.TextColor3 = window:getColors().TextSecondary
        tabBtn.TextSize = 13
        tabBtn.Font = Config.Fonts.Medium
        tabBtn.LayoutOrder = #window.Pages + 1
        tabBtn.AutoButtonColor = false
        tabBtn.Parent = tabContainer
        Corner(tabBtn, Config.Radius.md)

        local tabPadding = Instance.new('UIPadding')
        tabPadding.PaddingLeft = UDim.new(0, 16)
        tabPadding.PaddingRight = UDim.new(0, 16)
        tabPadding.Parent = tabBtn

        local tabBtnStroke = Stroke(tabBtn, nil, 1.5, 1) -- Slightly thicker white stroke for active tab
        tabBtnStroke.Name = "TabButtonStroke"

        local pageFrame = Instance.new('ScrollingFrame')
        pageFrame.Size = UDim2.new(1, 0, 1, 0)
        pageFrame.BackgroundTransparency = 1
        pageFrame.BorderSizePixel = 0
        pageFrame.ScrollBarThickness = 3
        pageFrame.ScrollBarImageColor3 = window:getColors().Primary
        pageFrame.ScrollBarImageTransparency = 0.7
        pageFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
        pageFrame.Visible = false
        pageFrame.Parent = content

        local pagePadding = Instance.new('UIPadding')
        pagePadding.PaddingTop = UDim.new(0, Config.Spacing.md)
        pagePadding.PaddingBottom = UDim.new(0, Config.Spacing.xl)
        pagePadding.Parent = pageFrame

        local pageLayout = ListLayout(pageFrame, Config.Layout.RowSpacing, Enum.FillDirection.Vertical)

        pageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            pageFrame.CanvasSize = UDim2.new(
                0,
                0,
                0,
                pageLayout.AbsoluteContentSize.Y + Config.Spacing.xl * 2
            )
        end)

        tabBtn.MouseButton1Click:Connect(function()
            for _, p in pairs(window.Pages) do
                if p._button and p._button.Parent and p._frame and p._frame.Parent then
                    p._frame.Visible = false
                    Tween(p._button, {
                        BackgroundColor3 = window:getColors().Surface2,
                        TextColor3 = window:getColors().TextSecondary,
                        Size = UDim2.new(0, p._button.AbsoluteSize.X, 0, 30)
                    }, Config.Animation.Medium, Config.Easing.Interaction):Play()
                    local currentTabStroke = p._button:FindFirstChild("TabButtonStroke")
                    if currentTabStroke then Tween(currentTabStroke, { Transparency = 1 }, Config.Animation.Medium):Play() end
                end
            end
            pageFrame.Visible = true
            Tween(tabBtn, {
                BackgroundColor3 = window:getColors().Primary,
                TextColor3 = Color3.fromRGB(255, 255, 255),
                Size = UDim2.new(0, tabBtn.AbsoluteSize.X, 0, 30)
            }, Config.Animation.Medium, Config.Easing.Interaction):Play()
            Tween(tabBtnStroke, { Transparency = 0 }, Config.Animation.Medium):Play()
            window.CurrentPage = page
        end)

        tabBtn.MouseEnter:Connect(function()
            if window.CurrentPage ~= page then
                Tween(tabBtn, { BackgroundColor3 = window:getColors().Surface3 }, Config.Animation.Fast):Play()
            end
            Tween(tabBtnStroke, { Transparency = 0.5 }, Config.Animation.Fast):Play() -- Subtle white stroke on hover
            Tween(tabBtn, { Size = UDim2.new(0, tabBtn.AbsoluteSize.X + 4, 0, 32), Position = UDim2.new(tabBtn.Position.X.Scale, tabBtn.Position.X.Offset -2, 0, tabBtn.Position.Y.Offset -1) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
        end)
        tabBtn.MouseLeave:Connect(function()
            if window.CurrentPage ~= page then
                Tween(tabBtn, { BackgroundColor3 = window:getColors().Surface2 }, Config.Animation.Fast):Play()
            end
            -- Revert stroke transparency based on active state, if not current page, hide.
            local targetTransparency = (window.CurrentPage == page) and 0 or 1
            Tween(tabBtnStroke, { Transparency = targetTransparency }, Config.Animation.Fast):Play()
            Tween(tabBtn, { Size = UDim2.new(0, tabBtn.AbsoluteSize.X - 4, 0, 30), Position = UDim2.new(tabBtn.Position.X.Scale, tabBtn.Position.X.Offset +2, 0, tabBtn.Position.Y.Offset +1) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
        end)

        page._button = tabBtn
        page._frame = pageFrame

        function page:CreateButton(text, callback)
            local container = Instance.new('Frame')
            container.Size = UDim2.new(1, 0, 0, Config.Layout.RowHeight)
            container.BackgroundTransparency = 1
            container.Parent = pageFrame

            local btn = Instance.new('TextButton')
            btn.Size = UDim2.new(1, 0, 1, 0)
            btn.BackgroundColor3 = window:getColors().Primary
            btn.BorderSizePixel = 0
            btn.Text = text
            btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            btn.TextSize = 14
            btn.Font = Config.Fonts.Medium
            btn.AutoButtonColor = false
            btn.Parent = container
            Corner(btn, Config.Radius.md)

            local btnStroke = Stroke(btn, nil, 1, 1)

            btn.MouseEnter:Connect(function()
                Tween(btn, { BackgroundColor3 = window:getColors().PrimaryHover,
                             Size = UDim2.new(1, 2, 1, 2), Position = UDim2.new(0, -1, 0, -1) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
                Tween(btnStroke, { Transparency = 0 }, Config.Animation.Fast):Play()
            end)
            btn.MouseLeave:Connect(function()
                Tween(btn, { BackgroundColor3 = window:getColors().Primary,
                             Size = UDim2.new(1, 0, 1, 0), Position = UDim2.new(0, 0, 0, 0) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
                Tween(btnStroke, { Transparency = 1 }, Config.Animation.Fast):Play()
            end)
            btn.MouseButton1Click:Connect(function()
                Tween(btn, { BackgroundColor3 = window:getColors().PrimaryDim,
                             Size = UDim2.new(1, -2, 1, -2), Position = UDim2.new(0, 1, 0, 1) }, Config.Animation.Fast, Config.Easing.Interaction, Enum.EasingDirection.In):Play()
                task.wait(0.06)
                Tween(btn, { BackgroundColor3 = window:getColors().Primary,
                             Size = UDim2.new(1, 0, 1, 0), Position = UDim2.new(0, 0, 0, 0) }, Config.Animation.Fast, Config.Easing.Interaction, Enum.EasingDirection.Out):Play()
                if callback then
                    callback()
                end
            end)

            table.insert(page.Elements, container)
            return container
        end

        function page:CreateToggle(text, defaultValue, callback)
            local value = defaultValue or false

            local container = Instance.new('Frame')
            container.Size = UDim2.new(1, 0, 0, Config.Layout.RowHeight)
            container.BackgroundColor3 = window:getColors().Surface
            container.BorderSizePixel = 0
            container.Parent = pageFrame
            Corner(container, Config.Radius.md)
            Stroke(container, nil, 1) -- White stroke for toggle container

            local label = Instance.new('TextLabel')
            label.Size = UDim2.new(1, -70, 1, 0)
            label.Position = UDim2.new(0, Config.Spacing.lg, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = window:getColors().Text
            label.TextSize = 14
            label.Font = Config.Fonts.Regular
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = container

            local toggle = Instance.new('TextButton')
            toggle.Size = UDim2.new(0, 48, 0, 24)
            toggle.Position = UDim2.new(1, -Config.Spacing.lg - 48, 0.5, -12)
            toggle.BackgroundColor3 = value and window:getColors().Primary or window:getColors().Surface3
            toggle.BorderSizePixel = 0
            toggle.Text = ''
            toggle.AutoButtonColor = false
            toggle.Parent = container
            Corner(toggle, 12)

            local toggleStroke = Stroke(toggle, nil, 1, 1)

            local thumb = Instance.new('Frame')
            thumb.Size = UDim2.new(0, 20, 0, 20)
            thumb.Position = value and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 4, 0.5, -10)
            thumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            thumb.BorderSizePixel = 0
            thumb.Parent = toggle
            Corner(thumb, 10)

            toggle.MouseEnter:Connect(function()
                Tween(toggleStroke, { Transparency = 0 }, Config.Animation.Fast):Play()
                if not value then
                    Tween(toggle, { Size = UDim2.new(0, 50, 0, 26), Position = UDim2.new(1, -Config.Spacing.lg - 49, 0.5, -13) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
                    Tween(thumb, { Size = UDim2.new(0, 22, 0, 22), Position = UDim2.new(thumb.Position.X.Scale, thumb.Position.X.Offset -1, 0.5, -11) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
                end
            end)
            toggle.MouseLeave:Connect(function()
                Tween(toggleStroke, { Transparency = 1 }, Config.Animation.Fast):Play()
                if not value then
                    Tween(toggle, { Size = UDim2.new(0, 48, 0, 24), Position = UDim2.new(1, -Config.Spacing.lg - 48, 0.5, -12) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
                    Tween(thumb, { Size = UDim2.new(0, 20, 0, 20), Position = UDim2.new(thumb.Position.X.Scale, thumb.Position.X.Offset +1, 0.5, -10) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
                end
            end)

            toggle.MouseButton1Click:Connect(function()
                value = not value
                Tween(toggle, { BackgroundColor3 = value and window:getColors().Primary or window:getColors().Surface3 }, Config.Animation.Medium, Config.Easing.Slide):Play()
                Tween(thumb, { Position = value and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 4, 0.5, -10),
                               Size = UDim2.new(0, 22, 0, 22) }, Config.Animation.Medium, Config.Easing.Bounce, Enum.EasingDirection.Out):Play()
                task.wait(0.08)
                Tween(thumb, { Size = UDim2.new(0, 20, 0, 20) }, Config.Animation.Fast):Play()
                if callback then
                    callback(value)
                end
            end)

            table.insert(page.Elements, container)
            return container, function()
                return value
            end
        end

        function page:CreateSlider(text, min, max, defaultValue, callback)
            min, max = min or 0, max or 100
            local value = defaultValue or min

            local container = Instance.new('Frame')
            container.Size = UDim2.new(1, 0, 0, Config.Layout.RowHeight + Config.Spacing.md)
            container.BackgroundColor3 = window:getColors().Surface
            container.BorderSizePixel = 0
            container.Parent = pageFrame
            Corner(container, Config.Radius.md)
            Stroke(container, nil, 1) -- White stroke for slider container

            local headerFrame = Instance.new('Frame')
            headerFrame.Size = UDim2.new(1, 0, 0, 24)
            headerFrame.Position = UDim2.new(0, 0, 0, Config.Spacing.md)
            headerFrame.BackgroundTransparency = 1
            headerFrame.Parent = container

            local label = Instance.new('TextLabel')
            label.Size = UDim2.new(1, -60, 1, 0)
            label.Position = UDim2.new(0, Config.Spacing.lg, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = window:getColors().Text
            label.TextSize = 14
            label.Font = Config.Fonts.Regular
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = headerFrame

            local valueLabel = Instance.new('TextLabel')
            valueLabel.Size = UDim2.new(0, 50, 1, 0)
            valueLabel.Position = UDim2.new(1, -Config.Spacing.lg - 50, 0, 0)
            valueLabel.BackgroundTransparency = 1
            valueLabel.Text = tostring(value)
            valueLabel.TextColor3 = window:getColors().Primary
            valueLabel.TextSize = 13
            valueLabel.Font = Config.Fonts.Bold
            valueLabel.TextXAlignment = Enum.TextXAlignment.Right
            valueLabel.Parent = headerFrame

            local track = Instance.new('Frame')
            track.Size = UDim2.new(1, -Config.Spacing.lg * 2, 0, 6)
            track.Position = UDim2.new(0, Config.Spacing.lg, 1, -Config.Spacing.md - 4)
            track.BackgroundColor3 = window:getColors().Surface3
            track.BorderSizePixel = 0
            track.Parent = container
            Corner(track, 3)

            local trackStroke = Stroke(track, nil, 1, 1)

            local fill = Instance.new('Frame')
            fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
            fill.BackgroundColor3 = window:getColors().Primary
            fill.BorderSizePixel = 0
            fill.Parent = track
            Corner(fill, 3)

            local thumb = Instance.new('Frame')
            thumb.Size = UDim2.new(0, 16, 0, 16)
            thumb.Position = UDim2.new(fill.Size.X.Scale, -8, 0.5, -8)
            thumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            thumb.BorderSizePixel = 0
            thumb.Parent = track
            Corner(thumb, 8)
            Stroke(thumb, nil, 1) -- White stroke for slider thumb

            local dragging = false

            local function updateSlider(input)
                local percent = math.clamp(
                    (input.Position.X - track.AbsolutePosition.X) / track.AbsoluteSize.X,
                    0, 1
                )
                value = math.round(min + (max - min) * percent)
                valueLabel.Text = tostring(value)
                Tween(fill, { Size = UDim2.new(percent, 0, 1, 0) }, Config.Animation.Fast, Enum.EasingStyle.Linear):Play()
                Tween(thumb, { Position = UDim2.new(percent, -8, 0.5, -8) }, Config.Animation.Fast, Enum.EasingStyle.Linear):Play()
                if callback then callback(value) end
            end

            track.MouseEnter:Connect(function()
                Tween(trackStroke, { Transparency = 0 }, Config.Animation.Fast):Play()
            end)
            track.MouseLeave:Connect(function()
                Tween(trackStroke, { Transparency = 1 }, Config.Animation.Fast):Play()
            end)

            track.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = true
                    updateSlider(input)
                    Tween(thumb, { Size = UDim2.new(0, 20, 0, 20), Position = UDim2.new(thumb.Position.X.Scale, -10, 0.5, -10) }, Config.Animation.Fast, Config.Easing.Bounce, Enum.EasingDirection.Out):Play()
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
                    updateSlider(input)
                end
            end)

            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                    Tween(thumb, { Size = UDim2.new(0, 16, 0, 16), Position = UDim2.new(thumb.Position.X.Scale, -8, 0.5, -8) }, Config.Animation.Fast, Config.Easing.Bounce, Enum.EasingDirection.Out):Play()
                end
            end)

            table.insert(page.Elements, container)
            return container, function() return value end
        end

        function page:CreateDropdown(text, options, defaultValue, callback)
            options = options or {}
            local value = defaultValue or (options[1] or 'Select...')
            local isOpen = false

            local container = Instance.new('Frame')
            container.Size = UDim2.new(1, 0, 0, Config.Layout.RowHeight)
            container.BackgroundColor3 = window:getColors().Surface
            container.BorderSizePixel = 0
            container.Parent = pageFrame
            Corner(container, Config.Radius.md)
            Stroke(container, nil, 1) -- White stroke for dropdown container

            local label = Instance.new('TextLabel')
            label.Size = UDim2.new(0.4, 0, 1, 0)
            label.Position = UDim2.new(0, Config.Spacing.lg, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = window:getColors().Text
            label.TextSize = 14
            label.Font = Config.Fonts.Regular
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = container

            local dropdown = Instance.new('TextButton')
            dropdown.Size = UDim2.new(0.6, -Config.Spacing.lg, 0, 30)
            dropdown.Position = UDim2.new(0.4, 0, 0.5, -15)
            dropdown.BackgroundColor3 = window:getColors().Surface2
            dropdown.BorderSizePixel = 0
            dropdown.Text = ''
            dropdown.ClipsDescendants = true
            dropdown.AutoButtonColor = false
            dropdown.Parent = container
            dropdown.ZIndex = 5
            Corner(dropdown, Config.Radius.sm)

            local dropdownStroke = Stroke(dropdown, nil, 1, 1)

            local valueText = Instance.new('TextLabel')
            valueText.Size = UDim2.new(1, -32, 1, 0)
            valueText.Position = UDim2.new(0, Config.Spacing.md, 0, 0)
            valueText.BackgroundTransparency = 1
            valueText.Text = value
            valueText.TextColor3 = window:getColors().Text
            valueText.TextSize = 13
            valueText.Font = Config.Fonts.Regular
            valueText.TextXAlignment = Enum.TextXAlignment.Left
            valueText.Parent = dropdown

            local arrow = Instance.new('TextLabel')
            arrow.Size = UDim2.new(0, 24, 1, 0)
            arrow.Position = UDim2.new(1, -24, 0, 0)
            arrow.BackgroundTransparency = 1
            arrow.Text = 'â–¼'
            arrow.TextColor3 = window:getColors().TextMuted
            arrow.TextSize = 10
            arrow.Font = Config.Fonts.Regular
            arrow.Parent = dropdown

            dropdown.MouseEnter:Connect(function()
                Tween(dropdownStroke, { Transparency = 0 }, Config.Animation.Fast):Play()
                Tween(dropdown, { Size = UDim2.new(0.6, -Config.Spacing.lg + 2, 0, 32), Position = UDim2.new(0.4, -1, 0.5, -16) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
            end)
            dropdown.MouseLeave:Connect(function()
                Tween(dropdownStroke, { Transparency = 1 }, Config.Animation.Fast):Play()
                Tween(dropdown, { Size = UDim2.new(0.6, -Config.Spacing.lg, 0, 30), Position = UDim2.new(0.4, 0, 0.5, -15) }, Config.Animation.Fast, Config.Easing.Interaction):Play()
            end)

            local optionsList = Instance.new('Frame')
            optionsList.Size = UDim2.new(0.6, -Config.Spacing.lg, 0, 0)
            optionsList.Position = UDim2.new(0.4, 0, 1, 2)
            optionsList.BackgroundColor3 = window:getColors().Surface
            optionsList.BorderSizePixel = 0
            optionsList.Visible = false
            optionsList.ZIndex = 6
            optionsList.Parent = container
            Corner(optionsList, Config.Radius.sm)
            Stroke(optionsList, nil, 1) -- White stroke for dropdown list
            optionsList.ClipsDescendants = true

            ListLayout(optionsList, 0, Enum.FillDirection.Vertical)

            local function toggleDropdown()
                isOpen = not isOpen
                local targetHeight = isOpen and (#options * 28) or 0
                optionsList.Visible = true
                Tween(optionsList, { Size = UDim2.new(0.6, -Config.Spacing.lg, 0, targetHeight) }, Config.Animation.Medium, Config.Easing.Quart):Play()
                Tween(arrow, { Rotation = isOpen and 180 or 0 }, Config.Animation.Medium):Play()
                if not isOpen then
                    task.wait(Config.Animation.Medium)
                    optionsList.Visible = false
                end
            end

            dropdown.MouseButton1Click:Connect(toggleDropdown)

            for i, option in ipairs(options) do
                local optionBtn = Instance.new('TextButton')
                optionBtn.Size = UDim2.new(1, 0, 0, 28)
                optionBtn.BackgroundColor3 = window:getColors().Surface
                optionBtn.BackgroundTransparency = 1
                optionBtn.BorderSizePixel = 0
                optionBtn.Text = ''
                optionBtn.LayoutOrder = i
                optionBtn.AutoButtonColor = false
                optionBtn.Parent = optionsList
                optionBtn.ZIndex = 6

                local optionText = Instance.new('TextLabel')
                optionText.Size = UDim2.new(1, -Config.Spacing.md * 2, 1, 0)
                optionText.Position = UDim2.new(0, Config.Spacing.md, 0, 0)
                optionText.BackgroundTransparency = 1
                optionText.Text = option
                optionText.TextColor3 = window:getColors().Text
                optionText.TextSize = 13
                optionText.Font = Config.Fonts.Regular
                optionText.TextXAlignment = Enum.TextXAlignment.Left
                optionText.Parent = optionBtn

                optionBtn.MouseEnter:Connect(function()
                    Tween(optionBtn, { BackgroundTransparency = 0, BackgroundColor3 = window:getColors().Surface2 }, Config.Animation.Fast):Play()
                end)
                optionBtn.MouseLeave:Connect(function()
                    Tween(optionBtn, { BackgroundTransparency = 1 }, Config.Animation.Fast):Play()
                end)
                optionBtn.MouseButton1Click:Connect(function()
                    value = option
                    valueText.Text = option
                    toggleDropdown()
                    if callback then callback(option) end
                end)
            end

            table.insert(page.Elements, container)
            return container, function() return value end
        end

        window.Pages[name] = page

        if not window.CurrentPage then
            pageFrame.Visible = true
            Tween(tabBtn, { BackgroundColor3 = window:getColors().Primary, TextColor3 = Color3.fromRGB(255, 255, 255) }, Config.Animation.Fast):Play()
            tabBtnStroke.Transparency = 0
            window.CurrentPage = page
        end

        return page
    end

    function window:Destroy()
        for _, connection in pairs(window._connections) do
            if connection.Connected then
                connection:Disconnect()
            end
        end
        if gui and gui.Parent then
            gui:Destroy()
        end
    end

    -- Initial entrance animation for the main window
    main.Size = UDim2.new(size.X.Scale * 0.8, size.X.Offset * 0.8, size.Y.Scale * 0.8, size.Y.Offset * 0.8)
    Tween(main, { Size = size, Transparency = 0 }, Config.Animation.Slow, Config.Easing.Main, Enum.EasingDirection.Out):Play()
    if mainGlossEffect then Tween(mainGlossEffect, {Transparency = 0.9}, Config.Animation.Slow, Config.Easing.Main, Enum.EasingDirection.Out):Play() end


    return window
end

-- Expose MinimalGUI_Instance to global environment for detection
if getgenv then
    getgenv().MinimalGUI_Instance = MinimalGUI
end

-- Destroys all active GUI elements created by this library instance
function MinimalGUI:DestroyAll()
    if typeof(self.CurrentWindow) == "table" and self.CurrentWindow.Destroy then
        pcall(function() self.CurrentWindow:Destroy() end)
    end

    for _, notif in ipairs(notificationQueue) do
        if notif and notif.Parent then
            pcall(function() notif:Destroy() end)
        end
    end
    notificationQueue = {}

    if NotificationsScreenGui and NotificationsScreenGui.Parent then
        pcall(function() NotificationsScreenGui:Destroy() end)
    end
    NotificationsScreenGui = nil
    NotificationsFrame = nil

    self.CurrentWindow = nil

    setmetatable(self, nil)
    for k in pairs(self) do
        self[k] = nil
    end
end

return MinimalGUI
